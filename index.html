<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexa BizMaster | Khagesh ai-nexa</title>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --p: #0ea5e9; --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; }
        [data-theme="light"] { --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); padding-bottom: 85px; overflow-x: hidden; }
        
        /* Trial Overlay */
        #lock { position: fixed; inset: 0; background: #0f172a; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        .lock-card { background: #1e293b; padding: 30px; border-radius: 20px; border: 1px solid #ef4444; max-width: 90%; }

        .ceo-header { text-align: center; padding: 20px; background: linear-gradient(135deg, #0ea5e9, #38bdf8); color: white; position: relative; }
        .ceo-name { font-size: 22px; font-weight: 800; border: none; background: transparent; color: white; text-align: center; width: 100%; outline: none; text-transform: uppercase; }
        .ceo-addr { font-size: 11px; opacity: 0.9; border: none; background: transparent; color: white; text-align: center; width: 100%; outline: none; }
        
        .glass-card { background: var(--card); border: 1px solid var(--border); border-radius: 18px; padding: 18px; margin: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .prog-bg { background: rgba(255,255,255,0.1); height: 10px; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        .prog-fill { background: var(--p); height: 100%; width: 0%; border-radius: 5px; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .full { grid-column: span 2; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--card); color: var(--text); outline: none; }
        
        .main-btn { width: 100%; background: var(--p); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; margin-top: 10px; }
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; border-top: 1px solid var(--border); height: 70px; }
        .tab { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: #94a3b8; }
        .tab.active { color: var(--p); border-top: 3px solid var(--p); }
        .panel { display: none; padding: 5px; }
        .panel.active { display: block; }
        .ledger-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding: 12px 0; }
        .wa-btn { background: #25d366; color: white; border: none; padding: 6px 10px; border-radius: 5px; font-size: 10px; margin-top: 4px; }
    </style>
</head>
<body data-theme="dark">

<div id="lock">
    <div class="lock-card">
        <h2 style="color:#ef4444">Trial Expired! ‚ùå</h2>
        <p style="margin: 15px 0; font-size: 14px; opacity: 0.8;">Aapka 7-din ka trial khatam ho chuka hai ya system clock ke saath chhed-chhad hui hai. Please activate karein.</p>
        <input type="password" id="mKey" placeholder="Enter Activation Key" style="margin-bottom:15px; text-align:center;">
        <button onclick="activate()" class="main-btn" style="background:#16a34a">ACTIVATE NOW</button>
        <p style="margin-top:20px; font-size:11px;">Powered by Khagesh ai-nexa</p>
    </div>
</div>

<div class="ceo-header">
    <div onclick="toggleTheme()" style="position:absolute; right:15px; top:10px; cursor:pointer;">üåì</div>
    <div style="font-size: 9px; font-weight: bold; opacity: 0.8;">NEXA BIZMASTER PRO</div>
    <input type="text" id="fName" class="ceo-name" oninput="saveC()">
    <input type="text" id="fAddr" class="ceo-addr" oninput="saveC()">
</div>

<div style="display:flex; gap:10px; padding:10px;">
    <button onclick="document.getElementById('imp').click()" style="flex:1; padding:10px; border-radius:10px; border:1px solid var(--border); background:var(--card); color:var(--text); font-size:12px;">üì• Import</button>
    <button onclick="forceExport()" style="flex:1; padding:10px; border-radius:10px; background:#0f172a; color:white; font-size:12px; font-weight:bold;">üìÑ Audit Report</button>
    <input type="file" id="imp" hidden onchange="importData(event)">
</div>

<div id="Home" class="panel active">
    <div class="glass-card">
        <div style="display:flex; justify-content: space-between; font-size: 13px;">
            <span>Sales Goal</span>
            <span id="pVal" style="color:var(--p)">0%</span>
        </div>
        <div class="prog-bg"><div id="pBar" class="prog-fill"></div></div>
        <div style="display:flex; justify-content: space-between; font-size: 11px;">
            <span>Earned: <b id="currEarned">‚Çπ0</b></span>
            <span onclick="setG()" style="cursor:pointer; color:var(--p)">Target: <b id="gVal">‚Çπ0</b></span>
        </div>
    </div>

    <div class="glass-card">
        <h4 style="margin-bottom:10px; font-size:14px; color:var(--p)">New Entry</h4>
        <div class="form-grid">
            <input type="hidden" id="editId">
            <input type="text" id="cName" placeholder="Client Name" class="full">
            <input type="text" id="cApp" placeholder="Product/Service" class="full">
            <input type="number" id="cAmt" placeholder="Amount (‚Çπ)">
            <input type="date" id="cDate">
            <select id="cStatus" class="full"><option value="Paid">Paid</option><option value="Pending">Pending</option></select>
            <button id="addBtn" class="main-btn full" onclick="save()">SAVE RECORD üöÄ</button>
        </div>
    </div>
</div>

<div id="Ledger" class="panel">
    <div class="glass-card">
        <input type="text" id="search" placeholder="Search..." oninput="render()" style="margin-bottom:10px;">
        <div id="list"></div>
    </div>
</div>

<div id="Billing" class="panel">
    <div class="glass-card">
        <h4 style="margin-bottom:10px;">Billing Center</h4>
        <div id="billList"></div>
    </div>
</div>

<div class="tab-bar">
    <div class="tab active" onclick="tab('Home', this)">üè† HOME</div>
    <div class="tab" onclick="tab('Ledger', this)">üìë LEDGER</div>
    <div class="tab" onclick="tab('Billing', this)">üßæ BILLS</div>
</div>

<script>
    // --- TRIAL SYSTEM LOGIC ---
    const CONFIG = {
        trialDays: 7,
        trialStartDate: "2026-02-16", // Change for new clients
        masterKey: "Permanentkey63793119"
    };

    function checkTrial() {
        if(localStorage.getItem('biz_active') === 'true') return;
        
        const start = new Date(CONFIG.trialStartDate);
        const today = new Date();
        const diff = Math.ceil((today - start) / (1000 * 60 * 60 * 24));
        
        // Anti-Tamper: Last login check
        const lastLogin = localStorage.getItem('last_login') || CONFIG.trialStartDate;
        if(new Date(lastLogin) > today || diff > CONFIG.trialDays || diff < 0) {
            document.getElementById('lock').style.display = 'flex';
        }
        localStorage.setItem('last_login', today.toISOString());
    }

    function activate() {
        if(document.getElementById('mKey').value === CONFIG.masterKey) {
            localStorage.setItem('biz_active', 'true');
            document.getElementById('lock').style.display = 'none';
            alert("Nexa BizMaster Activated Lifetime! üèÜ");
        } else { alert("Invalid Key!"); }
    }

    // --- CORE APP LOGIC ---
    let db, allData = [], goal = localStorage.getItem('biz_goal') || 50000;
    
    document.getElementById('fName').value = localStorage.getItem('cN') || "KHAGESH AI-NEXA";
    document.getElementById('fAddr').value = localStorage.getItem('cA') || "8882737014 | Delhi";
    function saveC(){ localStorage.setItem('cN', document.getElementById('fName').value); localStorage.setItem('cA', document.getElementById('fAddr').value); }

    const req = indexedDB.open("NexaBizMaster_DB", 1);
    req.onupgradeneeded = e => e.target.result.createObjectStore("sales", {keyPath:"id", autoIncrement:true});
    req.onsuccess = e => { db = e.target.result; load(); checkTrial(); };

    function tab(id, el) {
        document.querySelectorAll('.panel, .tab').forEach(x => x.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        if(id === 'Billing') renderBilling();
    }

    function save() {
        const id = document.getElementById('editId').value;
        const data = {
            name: document.getElementById('cName').value,
            app: document.getElementById('cApp').value,
            amt: parseFloat(document.getElementById('cAmt').value) || 0,
            date: document.getElementById('cDate').value,
            status: document.getElementById('cStatus').value
        };
        if(!data.name) return;
        const tx = db.transaction("sales", "readwrite");
        id ? (data.id = parseInt(id), tx.objectStore("sales").put(data)) : tx.objectStore("sales").add(data);
        tx.oncomplete = () => { load(); reset(); };
    }

    function load() {
        db.transaction("sales").objectStore("sales").getAll().onsuccess = e => {
            allData = e.target.result.reverse();
            render(); stats();
        };
    }

    function stats() {
        let p = 0; allData.forEach(i => { if(i.status === 'Paid') p += i.amt; });
        document.getElementById('gVal').innerText = `‚Çπ${goal}`;
        document.getElementById('currEarned').innerText = `‚Çπ${p}`;
        document.getElementById('pBar').style.width = Math.min((p/goal)*100, 100) + "%";
        document.getElementById('pVal').innerText = Math.min((p/goal)*100, 100).toFixed(1) + "%";
    }

    function render() {
        const list = document.getElementById('list'); list.innerHTML = "";
        allData.forEach(i => {
            list.innerHTML += `<div class="ledger-item">
                <div><b>${i.name}</b><br><small>${i.app}</small></div>
                <div style="text-align:right"><b>‚Çπ${i.amt}</b><br>
                <small onclick="edit(${i.id})" style="color:var(--p)">Edit</small></div></div>`;
        });
    }

    function renderBilling() {
        const list = document.getElementById('billList'); list.innerHTML = "";
        allData.forEach(i => {
            list.innerHTML += `<div class="ledger-item">
                <div><b>${i.name}</b><br><small>${i.date}</small></div>
                <div style="text-align:right">
                    <button class="wa-btn" style="background:#6366f1" onclick="genInvoice(${i.id})">PDF Bill</button>
                </div></div>`;
        });
    }

    async function forceExport() {
        const { jsPDF } = window.jspdf; const doc = new jsPDF();
        let total = 0;
        const body = allData.map(i => { total += i.amt; return [i.date, i.name, i.app, i.status, i.amt]; });
        doc.text(document.getElementById('fName').value, 14, 15);
        doc.autoTable({ startY: 25, head: [['Date', 'Client', 'Item', 'Status', 'Amt']], body: body });
        doc.text(`GRAND TOTAL: Rs. ${total}`, 14, doc.lastAutoTable.finalY + 10);
        doc.save("Audit_Report.pdf");
    }

    async function genInvoice(id) {
        const i = allData.find(x => x.id === id);
        const { jsPDF } = window.jspdf; const doc = new jsPDF();
        doc.setFontSize(20); doc.text(document.getElementById('fName').value, 15, 20);
        doc.setFontSize(10); doc.text(document.getElementById('fAddr').value, 15, 28);
        doc.autoTable({ startY: 40, head: [['Description', 'Status', 'Total']], body: [[i.app, i.status, `Rs. ${i.amt}`]] });
        doc.save(`Bill_${i.name}.pdf`);
    }

    function edit(id) {
        const item = allData.find(x => x.id === id);
        document.getElementById('editId').value = item.id;
        document.getElementById('cName').value = item.name;
        document.getElementById('cApp').value = item.app;
        document.getElementById('cAmt').value = item.amt;
        document.getElementById('cDate').value = item.date;
        tab('Home', document.querySelectorAll('.tab')[0]);
    }

    function importData(e) {
        const reader = new FileReader();
        reader.onload = ev => {
            const data = JSON.parse(ev.target.result);
            const tx = db.transaction("sales", "readwrite");
            data.forEach(i => { delete i.id; tx.objectStore("sales").add(i); });
            tx.oncomplete = () => load();
        };
        reader.readAsText(e.target.files[0]);
    }

    function toggleTheme() {
        const mode = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.body.setAttribute('data-theme', mode);
        localStorage.setItem('theme', mode);
    }
    function setG() { let g = prompt("Goal:", goal); if(g) { goal = g; localStorage.setItem('biz_goal', g); stats(); } }
    function reset() { 
        ['editId','cName','cApp','cAmt'].forEach(i => document.getElementById(i).value = "");
        document.getElementById('cDate').valueAsDate = new Date();
    }
    document.getElementById('cDate').valueAsDate = new Date();
</script>
</body>
    </html>
    
